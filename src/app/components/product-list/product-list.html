<div class="product-list-container">
    <div class="header">
        <div class="header-actions">
            <!-- Hidden File Input -->
            <input type="file" #fileInput (change)="onFileSelected($event)" accept=".json" style="display: none;">

            <button class="btn-import" (click)="fileInput.click()" title="Upload JSON">üì§ Import</button>
            <button class="btn-reset" (click)="resetCollections()">Reset DB</button>
            <button class="btn-add" (click)="openAddModal()">+ Add Product</button>
        </div>
    </div>

    <div class="product-grid">
        <div class="product-card" *ngFor="let item of items">
            <div class="card-image-wrapper">
            @if(item.image){
                <img *ngIf="item.image" [src]="item.image" alt="{{ item.name }}" class="product-img"> 
            }
            @else{
                <div class="no-image">
                    <span>{{ item.name.charAt(0) }}</span>
                </div>
            } 

                <!-- Stock Badge -->
                <div class="stock-badge" [class.low-stock]="item.stock < 10" [class.out-of-stock]="item.stock === 0">
                    {{ item.stock > 0 ? item.stock + ' in stock' : 'Out of Stock' }}
                </div>

                <!-- Overlay Actions -->
                <div class="card-overlay">
                    <button class="icon-btn edit-btn" (click)="startEdit(item)" title="Edit">
                        ‚úèÔ∏è
                    </button>
                    <button class="icon-btn delete-btn" (click)="deleteItem(item)" title="Delete">
                        üóëÔ∏è
                    </button>
                </div>
            </div>

            <div class="card-content">
                <div class="card-header">
                    <h3 class="product-name">{{ item.name }}</h3>
                    <span class="product-price">‚Çπ{{ item.price | number:'1.2-2' }}</span>
                </div>
                <p class="product-desc">{{ item.description }}</p>
            </div>
        </div>
    </div>

    <div *ngIf="items.length === 0" class="no-items">
        <p>No products found.</p>
    </div>

    <!-- Add Product Modal -->
    <div class="modal-backdrop" *ngIf="isAddModalOpen" (click)="closeAddModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h3>{{ selectedItem ? 'Edit Product' : 'Add New Product' }}</h3>
                <button class="close-btn" (click)="closeAddModal()">√ó</button>
            </div>
            <div class="modal-body">
                <app-item-add [item]="selectedItem" (itemAdded)="onItemAdded()"></app-item-add>
            </div>
        </div>
    </div>
</div>